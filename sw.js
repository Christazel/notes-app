const CACHE_NAME="notes-app-v1",urlsToCache=["/","/index.html","/manifest.json","/images/icon-192.png","/images/icon-512.png","/images/favicon.png"];self.addEventListener("install",(e=>{e.waitUntil(caches.open(CACHE_NAME).then((async e=>{await Promise.all(urlsToCache.map((async a=>{try{const t=await fetch(a);t.ok?(await e.put(a,t.clone()),console.log(`[SW] ✅ Cached: ${a}`)):console.warn(`[SW] ⚠️ Gagal cache: ${a} - ${t.status}`)}catch(e){console.warn(`[SW] ⚠️ Error cache: ${a}`,e)}})))})))})),self.addEventListener("fetch",(e=>{e.respondWith(caches.match(e.request).then((a=>a||fetch(e.request))))})),self.addEventListener("activate",(e=>{e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>e!==CACHE_NAME&&caches.delete(e)))))))})),self.addEventListener("push",(function(e){const a=e.data?JSON.parse(e.data.text()):{title:"Notifikasi!",message:"Ada pesan baru dari Aplikasi Cerita."},t={body:a.message,icon:"/images/icon-192.png",badge:"/images/icon-512.png",vibrate:[200,100,200],data:{dateOfArrival:Date.now()}};"granted"===Notification.permission?e.waitUntil(self.registration.showNotification(a.title,t)):console.warn("[SW] ❌ Notifikasi diblokir: permission tidak diberikan")}));